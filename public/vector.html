<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transformar em Vetor (Pinecone)</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: linear-gradient(135deg, #26a69a 0%, #26c6da 100%); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; }
    .container { background:#fff; border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.1); padding:40px; max-width: 820px; width: 100%; }
    h1 { text-align:center; margin:0 0 16px; font-weight:500; }
    .tabs { display:flex; gap:10px; margin-bottom: 16px; }
    .tab { flex:1; padding:12px; text-align:center; border:2px solid #e0f2f1; border-radius:10px; cursor:pointer; }
    .tab.active { background:#e0f7fa; color:#00695c; border-color:#b2dfdb; }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    textarea { width:100%; height:220px; padding:12px; border:2px solid #eee; border-radius:10px; font-family: 'Courier New', monospace; }
    .btn { background: #26a69a; color:#fff; border:none; padding:14px; border-radius:10px; font-size:16px; width:100%; cursor:pointer; margin-top: 12px; }
    .btn.secondary { background:#667eea; }
    .file-input { display:none; }
    .file-label { display:block; padding:20px; border:2px dashed #ddd; border-radius:10px; text-align:center; cursor:pointer; background:#f9f9f9; }
    .meta { text-align:center; margin-bottom: 10px; }
    .loading { display:none; text-align:center; margin-top:10px; }
    .error { background:#ffebee; color:#c62828; padding:12px; border-radius:10px; margin-top:10px; display:none; }
    .success { background:#e8f5e8; color:#2e7d32; padding:12px; border-radius:10px; margin-top:10px; display:none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß† Transformar em Vetor</h1>
    <div class="meta">
      <a href="/index.html" style="color:#667eea; text-decoration:none; font-weight:600;">‚Üê Transformar em Excel</a>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('json')">JSON Direto</div>
      <div class="tab" onclick="switchTab('jsonfile')">Arquivo JSON</div>
      <div class="tab" onclick="switchTab('excel')">Arquivo Excel</div>
    </div>

    <div id="json-tab" class="tab-content active">
      <textarea id="jsonData" placeholder='[{ "titulo": "...", "problema": "...", "solucao": "..." }]'></textarea>
      <button class="btn" onclick="embedJson()">Transformar em Vetor (JSON)</button>
    </div>

    <div id="excel-tab" class="tab-content">
      <input id="excelFile" type="file" class="file-input" accept=".xlsx,.xls">
      <label for="excelFile" id="excelLabel" class="file-label">üìÅ Selecione um arquivo Excel (.xlsx)</label>
      <button class="btn" onclick="embedExcel()">Transformar em Vetor (Excel)</button>
    </div>

    <div id="jsonfile-tab" class="tab-content">
      <input id="jsonFile" type="file" class="file-input" accept=".json">
      <label for="jsonFile" id="jsonLabel" class="file-label">üìÅ Selecione um arquivo JSON (.json)</label>
      <button class="btn" onclick="embedJsonFile()">Transformar em Vetor (JSON arquivo)</button>
    </div>

    <div class="loading" id="loading">Processando...</div>
    <div class="error" id="error"></div>
    <div class="success" id="success"></div>
  </div>

  <script>
    function switchTab(name) {
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      document.querySelector(`.tab[onclick*="${name}"]`).classList.add('active');
      document.getElementById(`${name}-tab`).classList.add('active');
    }

    document.getElementById('excelFile').addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if (f) document.getElementById('excelLabel').textContent = `üìÑ ${f.name}`;
    });
    document.getElementById('jsonFile').addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if (f) document.getElementById('jsonLabel').textContent = `üìÑ ${f.name}`;
    });

    function showError(msg){ const el=document.getElementById('error'); el.textContent=msg; el.style.display='block'; document.getElementById('success').style.display='none'; }
    function showSuccess(msg){ const el=document.getElementById('success'); el.textContent=msg; el.style.display='block'; document.getElementById('error').style.display='none'; }
    function showLoading(t){ const el=document.getElementById('loading'); el.textContent=t||'Processando...'; el.style.display='block'; }
    function hideLoading(){ document.getElementById('loading').style.display='none'; }

    async function embedJson(){
      const pwd = prompt('Digite a senha para transformar em vetor:');
      if (pwd===null) return; if (pwd.trim()!=='01648728') return showError('Senha incorreta.');
      const str = document.getElementById('jsonData').value.trim();
      if(!str) return showError('Insira JSON.');
      let payload; try{ payload = JSON.parse(str); if(!Array.isArray(payload)) return showError('O JSON deve ser um array de objetos.'); }catch(e){ return showError('JSON inv√°lido.'); }
      showLoading('Enviando JSON para vetorizar...');
      try{
        const res = await fetch('/embed-json', { method:'POST', headers:{ 'Content-Type':'application/json', 'x-embed-password': pwd.trim() }, body: JSON.stringify(payload) });
        const out = await res.json(); hideLoading();
        if(!res.ok) return showError(out.error||'Falha ao salvar no banco vetorial.');
        const ns = out.namespace ? `/${out.namespace}` : '';
        showSuccess(`Vetores inseridos: ${out.upserted}. √çndice: ${out.index}${ns}. Modelo: ${out.model}.`);
      }catch(err){ hideLoading(); showError('Erro ao enviar JSON.'); }
    }

    async function embedExcel(){
      const pwd = prompt('Digite a senha para transformar em vetor:');
      if (pwd===null) return; if (pwd.trim()!=='01648728') return showError('Senha incorreta.');
      const file = document.getElementById('excelFile').files[0];
      if(!file) return showError('Selecione um arquivo Excel (.xlsx).');
      const fd = new FormData(); fd.append('excelFile', file);
      showLoading('Enviando Excel para vetorizar...');
      try{
        const res = await fetch('/embed-excel', { method:'POST', headers:{ 'x-embed-password': pwd.trim() }, body: fd });
        const out = await res.json(); hideLoading();
        if(!res.ok) return showError(out.error||'Falha ao salvar no banco vetorial.');
        const ns = out.namespace ? `/${out.namespace}` : '';
        showSuccess(`Vetores inseridos: ${out.upserted}. √çndice: ${out.index}${ns}. Modelo: ${out.model}.`);
      }catch(err){ hideLoading(); showError('Erro ao enviar Excel.'); }
    }

    async function embedJsonFile(){
      const pwd = prompt('Digite a senha para transformar em vetor:');
      if (pwd===null) return; if (pwd.trim()!=='01648728') return showError('Senha incorreta.');
      const file = document.getElementById('jsonFile').files[0];
      if(!file) return showError('Selecione um arquivo JSON (.json).');
      try{
        const text = await file.text();
        let payload;
        try{ payload = JSON.parse(text); if(!Array.isArray(payload)) return showError('O JSON deve ser um array de objetos.'); }
        catch(e){ return showError('Arquivo JSON inv√°lido.'); }
        showLoading('Enviando JSON para vetorizar...');
        const res = await fetch('/embed-json', { method:'POST', headers:{ 'Content-Type':'application/json', 'x-embed-password': pwd.trim() }, body: JSON.stringify(payload) });
        const out = await res.json(); hideLoading();
        if(!res.ok) return showError(out.error||'Falha ao salvar no banco vetorial.');
        const ns = out.namespace ? `/${out.namespace}` : '';
        showSuccess(`Vetores inseridos: ${out.upserted}. √çndice: ${out.index}${ns}. Modelo: ${out.model}.`);
      }catch(err){ hideLoading(); showError('Erro ao ler/enviar o arquivo JSON.'); }
    }
  </script>
</body>
</html>


